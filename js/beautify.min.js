function js_beautify(e,t){function B(e){e=typeof e==="undefined"?false:e;while(r.length&&(r[r.length-1]===" "||r[r.length-1]===c||r[r.length-1]===T||e&&(r[r.length-1]==="\n"||r[r.length-1]==="\r"))){r.pop()}}function j(e){return e.replace(/^\s\s*|\s\s*$/,"")}function F(e){e=e.replace(/\x0d/g,"");var t=[],n=e.indexOf("\n");while(n!==-1){t.push(e.substring(0,n));e=e.substring(n+1);n=e.indexOf("\n")}if(e.length){t.push(e)}return t}function I(){var e=_;_=false;q();_=e}function q(e,t){f.eat_next_space=false;if(_&&V(f.mode)){return}e=typeof e==="undefined"?true:e;t=typeof t==="undefined"?true:t;if(t){f.if_line=false;f.chain_extra_indentation=0}B();if(!r.length){return}if(r[r.length-1]!=="\n"||!e){S=true;r.push("\n")}if(T){r.push(T)}for(var n=0;n<f.indentation_level+f.chain_extra_indentation;n+=1){r.push(c)}if(f.var_line&&f.var_line_reindented){r.push(c)}}function R(){var e=" ";if(f.eat_next_space){f.eat_next_space=false}else if(s==="TK_COMMENT"){q()}else{if(r.length){e=r[r.length-1]}if(e!==" "&&e!=="\n"&&e!==c){r.push(" ")}}}function U(){S=false;f.eat_next_space=false;r.push(i)}function z(){f.indentation_level+=1}function W(){if(r.length&&r[r.length-1]===c){r.pop()}}function X(e){if(f){l.push(f)}f={previous_mode:f?f.mode:"BLOCK",mode:e,var_line:false,var_line_tainted:false,var_line_reindented:false,in_html_comment:false,if_line:false,chain_extra_indentation:0,in_case_statement:false,in_case:false,case_body:false,eat_next_space:false,indentation_level:f?f.indentation_level+(f.var_line&&f.var_line_reindented?1:0):0,ternary_depth:0}}function V(e){return e==="[EXPRESSION]"||e==="[INDENTED-EXPRESSION]"}function $(e){return G(e,["[EXPRESSION]","(EXPRESSION)","(FOR-EXPRESSION)","(COND-EXPRESSION)"])}function J(){w=f.mode==="DO_BLOCK";if(l.length>0){var e=f.mode;f=l.pop();f.previous_mode=e}}function K(e,t){for(var n=0;n<e.length;n++){var r=j(e[n]);if(r.charAt(0)!==t){return false}}return true}function Q(e){return G(e,["case","return","do","if","throw","else"])}function G(e,t){for(var n=0;n<t.length;n+=1){if(t[n]===e){return true}}return false}function Y(e){var t=false,n="",r=0,i="",s=0,o;while(t||r<e.length){o=e.charAt(r);r++;if(t){t=false;if(o==="x"){i=e.substr(r,2);r+=2}else if(o==="u"){i=e.substr(r,4);r+=4}else{n+="\\"+o;continue}if(!i.match(/^[0123456789abcdefABCDEF]+$/)){return e}s=parseInt(i,16);if(s>=0&&s<32){if(o==="x"){n+="\\x"+i}else{n+="\\u"+i}continue}else if(s==34||s===39||s==92){n+="\\"+String.fromCharCode(s)}else if(o==="x"&&s>126&&s<=255){return e}else{n+=String.fromCharCode(s)}}else if(o=="\\"){t=true}else{n+=o}}return n}function Z(e){var t=v;var r=n.charAt(t);while(G(r,h)&&r!==e){t++;if(t>=H){return 0}r=n.charAt(t)}return r}function et(){var e;var t;x=0;if(v>=H){return["","TK_EOF"]}E=false;var i=n.charAt(v);v+=1;var u=_&&V(f.mode);if(u){var a=0;while(G(i,h)){if(i==="\n"){B();r.push("\n");S=true;a=0}else{if(i==="	"){a+=4}else if(i==="\r"){}else{a+=1}}if(v>=H){return["","TK_EOF"]}i=n.charAt(v);v+=1}if(S){for(e=0;e<a;e++){r.push(" ")}}}else{while(G(i,h)){if(i==="\n"){x+=O?x<=O?1:0:1}if(v>=H){return["","TK_EOF"]}i=n.charAt(v);v+=1}if(L){if(x>1){for(e=0;e<x;e+=1){q(e===0);S=true}}}E=x>0}if(G(i,p)){if(v<H){while(G(n.charAt(v),p)){i+=n.charAt(v);v+=1;if(v===H){break}}}if(v!==H&&i.match(/^[0-9]+[Ee]$/)&&(n.charAt(v)==="-"||n.charAt(v)==="+")){var l=n.charAt(v);v+=1;var c=et();i+=l+c[0];return[i,"TK_WORD"]}if(i==="in"){return[i,"TK_OPERATOR"]}if(E&&s!=="TK_OPERATOR"&&s!=="TK_EQUALS"&&!f.if_line&&(L||o!=="var")){q()}return[i,"TK_WORD"]}if(i==="("||i==="["){return[i,"TK_START_EXPR"]}if(i===")"||i==="]"){return[i,"TK_END_EXPR"]}if(i==="{"){return[i,"TK_START_BLOCK"]}if(i==="}"){return[i,"TK_END_BLOCK"]}if(i===";"){return[i,"TK_SEMICOLON"]}if(i==="/"){var m="";var y=true;if(n.charAt(v)==="*"){v+=1;if(v<H){while(v<H&&!(n.charAt(v)==="*"&&n.charAt(v+1)&&n.charAt(v+1)==="/")){i=n.charAt(v);m+=i;if(i==="\n"||i==="\r"){y=false}v+=1;if(v>=H){break}}}v+=2;if(y&&x===0){return["/*"+m+"*/","TK_INLINE_COMMENT"]}else{return["/*"+m+"*/","TK_BLOCK_COMMENT"]}}if(n.charAt(v)==="/"){m=i;while(n.charAt(v)!=="\r"&&n.charAt(v)!=="\n"){m+=n.charAt(v);v+=1;if(v>=H){break}}if(E){q()}return[m,"TK_COMMENT"]}}if(i==="'"||i==='"'||i==="/"&&(s==="TK_WORD"&&Q(o)||o===")"&&G(f.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])||s==="TK_COMMA"||s==="TK_COMMENT"||s==="TK_START_EXPR"||s==="TK_START_BLOCK"||s==="TK_END_BLOCK"||s==="TK_OPERATOR"||s==="TK_EQUALS"||s==="TK_EOF"||s==="TK_SEMICOLON")){var b=i;var w=false,T=false;t=i;if(v<H){if(b==="/"){var N=false;while(w||N||n.charAt(v)!==b){t+=n.charAt(v);if(!w){w=n.charAt(v)==="\\";if(n.charAt(v)==="["){N=true}else if(n.charAt(v)==="]"){N=false}}else{w=false}v+=1;if(v>=H){return[t,"TK_STRING"]}}}else{while(w||n.charAt(v)!==b){t+=n.charAt(v);if(w){if(n.charAt(v)==="x"||n.charAt(v)==="u"){T=true}w=false}else{w=n.charAt(v)==="\\"}v+=1}}}v+=1;t+=b;if(T&&P){t=Y(t)}if(b==="/"){while(v<H&&G(n.charAt(v),p)){t+=n.charAt(v);v+=1}}return[t,"TK_STRING"]}if(i==="#"){if(r.length===0&&n.charAt(v)==="!"){t=i;while(v<H&&i!=="\n"){i=n.charAt(v);t+=i;v+=1}r.push(j(t)+"\n");q();return et()}var C="#";if(v<H&&G(n.charAt(v),g)){do{i=n.charAt(v);C+=i;v+=1}while(v<H&&i!=="#"&&i!=="=");if(i==="#"){}else if(n.charAt(v)==="["&&n.charAt(v+1)==="]"){C+="[]";v+=2}else if(n.charAt(v)==="{"&&n.charAt(v+1)==="}"){C+="{}";v+=2}return[C,"TK_WORD"]}}if(i==="<"&&n.substring(v-1,v+3)==="<!--"){v+=3;i="<!--";while(n.charAt(v)!=="\n"&&v<H){i+=n.charAt(v);v++}f.in_html_comment=true;return[i,"TK_COMMENT"]}if(i==="-"&&f.in_html_comment&&n.substring(v-1,v+2)==="-->"){f.in_html_comment=false;v+=2;if(E){q()}return["-->","TK_COMMENT"]}if(i==="."){return[i,"TK_DOT"]}if(G(i,d)){while(v<H&&G(i+n.charAt(v),d)){i+=n.charAt(v);v+=1;if(v>=H){break}}if(i===","){return[i,"TK_COMMA"]}else if(i==="="){return[i,"TK_EQUALS"]}else{return[i,"TK_OPERATOR"]}}return[i,"TK_UNKNOWN"]}var n,r,i,s,o,u,a,f,l,c;var h,p,d,v,m,g;var y,b,w;var E,S,x;var T="";t=t?t:{};var N;if(t.space_after_anon_function!==undefined&&t.jslint_happy===undefined){t.jslint_happy=t.space_after_anon_function}if(t.braces_on_own_line!==undefined){N=t.braces_on_own_line?"expand":"collapse"}N=t.brace_style?t.brace_style:N?N:"collapse";var C=t.indent_size?t.indent_size:4,k=t.indent_char?t.indent_char:" ",L=typeof t.preserve_newlines==="undefined"?true:t.preserve_newlines,A=typeof t.break_chained_methods==="undefined"?false:t.break_chained_methods,O=typeof t.max_preserve_newlines==="undefined"?false:t.max_preserve_newlines,M=t.jslint_happy==="undefined"?false:t.jslint_happy,_=typeof t.keep_array_indentation==="undefined"?false:t.keep_array_indentation,D=typeof t.space_before_conditional==="undefined"?true:t.space_before_conditional,P=typeof t.unescape_strings==="undefined"?false:t.unescape_strings;S=false;var H=e.length;c="";while(C>0){c+=k;C-=1}while(e&&(e.charAt(0)===" "||e.charAt(0)==="	")){T+=e.charAt(0);e=e.substring(1)}n=e;a="";s="TK_START_EXPR";o="";u="";r=[];w=false;h="\n\r	 ".split("");p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");g="0123456789".split("");d="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::";d+=" <%= <% %> <?= <? ?>";d=d.split(" ");m="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(",");l=[];X("BLOCK");v=0;while(true){var tt=et();i=tt[0];b=tt[1];if(b==="TK_EOF"){break}switch(b){case"TK_START_EXPR":if(i==="["){if(s==="TK_WORD"||o===")"){if(G(o,m)){R()}X("(EXPRESSION)");U();break}if(f.mode==="[EXPRESSION]"||f.mode==="[INDENTED-EXPRESSION]"){if(u==="]"&&o===","){if(f.mode==="[EXPRESSION]"){f.mode="[INDENTED-EXPRESSION]";if(!_){z()}}X("[EXPRESSION]");if(!_){q()}}else if(o==="["){if(f.mode==="[EXPRESSION]"){f.mode="[INDENTED-EXPRESSION]";if(!_){z()}}X("[EXPRESSION]");if(!_){q()}}else{X("[EXPRESSION]")}}else{X("[EXPRESSION]")}}else{if(a==="for"){X("(FOR-EXPRESSION)")}else if(G(a,["if","while"])){X("(COND-EXPRESSION)")}else{X("(EXPRESSION)")}}if(o===";"||s==="TK_START_BLOCK"){q()}else if(s==="TK_END_EXPR"||s==="TK_START_EXPR"||s==="TK_END_BLOCK"||o==="."){if(E){q()}}else if(s!=="TK_WORD"&&s!=="TK_OPERATOR"){R()}else if(a==="function"||a==="typeof"){if(M){R()}}else if(G(o,m)||o==="catch"){if(D){R()}}U();break;case"TK_DOT":if(Q(o)){R()}else if(o===")"){if(A||E){f.chain_extra_indentation=1;q(true,false)}}U();break;case"TK_END_EXPR":if(i==="]"){if(_){if(o==="}"){W();U();J();break}}else{if(f.mode==="[INDENTED-EXPRESSION]"){if(o==="]"){J();q();U();break}}}}J();U();break;case"TK_START_BLOCK":if(a==="do"){X("DO_BLOCK")}else{X("BLOCK")}if(N==="expand"||N==="expand-strict"){var nt=false;if(N==="expand-strict"){nt=Z()==="}";if(!nt){q(true)}}else{if(s!=="TK_OPERATOR"){if(o==="="||Q(o)&&o!=="else"){R()}else{q(true)}}}U();if(!nt){z()}}else{if(s!=="TK_OPERATOR"&&s!=="TK_START_EXPR"){if(s==="TK_START_BLOCK"){q()}else{R()}}else{if(V(f.previous_mode)&&o===","){if(u==="}"){R()}else{q()}}}z();U()}break;case"TK_END_BLOCK":J();if(N==="expand"||N==="expand-strict"){if(o!=="{"){q()}U()}else{if(s==="TK_START_BLOCK"){if(S){W()}else{B()}}else{if(V(f.mode)&&_){_=false;q();_=true}else{q()}}U()}break;case"TK_WORD":if(w){R();U();R();w=false;break}y="NONE";if(i==="function"){if(f.var_line&&s!=="TK_EQUALS"){f.var_line_reindented=true}if((S||o===";")&&o!=="{"&&s!=="TK_BLOCK_COMMENT"&&s!=="TK_COMMENT"){x=S?x:0;if(!L){x=1}for(var rt=0;rt<2-x;rt++){q(false)}}if(s==="TK_WORD"){if(o==="get"||o==="set"||o==="new"||o==="return"){R()}else{q()}}else if(s==="TK_OPERATOR"||o==="="){R()}else if($(f.mode)){}else{q()}U();a=i;break}if(i==="case"||i==="default"&&f.in_case_statement){q();if(f.case_body){f.indentation_level--;f.case_body=false;W()}U();f.in_case=true;f.in_case_statement=true;break}if(s==="TK_END_BLOCK"){if(!G(i.toLowerCase(),["else","catch","finally"])){y="NEWLINE"}else{if(N==="expand"||N==="end-expand"||N==="expand-strict"){y="NEWLINE"}else{y="SPACE";R()}}}else if(s==="TK_SEMICOLON"&&(f.mode==="BLOCK"||f.mode==="DO_BLOCK")){y="NEWLINE"}else if(s==="TK_SEMICOLON"&&$(f.mode)){y="SPACE"}else if(s==="TK_STRING"){y="NEWLINE"}else if(s==="TK_WORD"){if(o==="else"){B(true)}y="SPACE"}else if(s==="TK_START_BLOCK"){y="NEWLINE"}else if(s==="TK_END_EXPR"){R();y="NEWLINE"}if(G(i,m)&&o!==")"){if(o==="else"){y="SPACE"}else{y="NEWLINE"}}if(f.if_line&&s==="TK_END_EXPR"){f.if_line=false}if(G(i.toLowerCase(),["else","catch","finally"])){if(s!=="TK_END_BLOCK"||N==="expand"||N==="end-expand"||N==="expand-strict"){q()}else{B(true);R()}}else if(y==="NEWLINE"){if(Q(o)){R()}else if(s!=="TK_END_EXPR"){if((s!=="TK_START_EXPR"||i!=="var")&&o!==":"){if(i==="if"&&a==="else"&&o!=="{"){R()}else{f.var_line=false;f.var_line_reindented=false;q()}}}else if(G(i,m)&&o!==")"){f.var_line=false;f.var_line_reindented=false;q()}}else if(V(f.mode)&&o===","&&u==="}"){q()}else if(y==="SPACE"){R()}U();a=i;if(i==="var"){f.var_line=true;f.var_line_reindented=false;f.var_line_tainted=false}if(i==="if"){f.if_line=true}if(i==="else"){f.if_line=false}break;case"TK_SEMICOLON":U();f.var_line=false;f.var_line_reindented=false;if(f.mode==="OBJECT"){f.mode="BLOCK"}break;case"TK_STRING":if(s==="TK_END_EXPR"&&G(f.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])){R()}else if(s==="TK_WORD"){R()}else if(s==="TK_COMMA"||s==="TK_START_EXPR"||s==="TK_EQUALS"||s==="TK_OPERATOR"){if(L&&E&&f.mode!=="OBJECT"){q();r.push(c)}}else{q()}U();break;case"TK_EQUALS":if(f.var_line){f.var_line_tainted=true}R();U();R();break;case"TK_COMMA":if(f.var_line){if($(f.mode)||s==="TK_END_BLOCK"){f.var_line_tainted=false}if(f.var_line_tainted){U();f.var_line_reindented=true;f.var_line_tainted=false;q();break}else{f.var_line_tainted=false}U();R();break}if(s==="TK_COMMENT"){q()}if(s==="TK_END_BLOCK"&&f.mode!=="(EXPRESSION)"){U();if(f.mode==="OBJECT"&&o==="}"){q()}else{R()}}else{if(f.mode==="OBJECT"){U();q()}else{U();R()}}break;case"TK_OPERATOR":var it=true;var st=true;if(Q(o)){R();U();break}if(i==="*"&&s==="TK_DOT"&&!u.match(/^\d+$/)){U();break}if(i===":"&&f.in_case){f.case_body=true;z();U();q();f.in_case=false;break}if(i==="::"){U();break}if(G(i,["--","++","!"])||G(i,["-","+"])&&(G(s,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||G(o,m)||o==",")){it=false;st=false;if(o===";"&&$(f.mode)){it=true}if(s==="TK_WORD"&&G(o,m)){it=true}if(f.mode==="BLOCK"&&(o==="{"||o===";")){q()}}else if(i===":"){if(f.ternary_depth===0){if(f.mode==="BLOCK"){f.mode="OBJECT"}it=false}else{f.ternary_depth-=1}}else if(i==="?"){f.ternary_depth+=1}if(it){R()}U();if(st){R()}break;case"TK_BLOCK_COMMENT":var ot=F(i);var ut;if(K(ot.slice(1),"*")){q();r.push(ot[0]);for(ut=1;ut<ot.length;ut++){q();r.push(" ");r.push(j(ot[ut]))}}else{if(ot.length>1){q()}else{if(s==="TK_END_BLOCK"){q()}else{R()}}for(ut=0;ut<ot.length;ut++){r.push(ot[ut]);r.push("\n")}}if(Z("\n")!=="\n"){q()}break;case"TK_INLINE_COMMENT":R();U();if($(f.mode)){R()}else{I()}break;case"TK_COMMENT":if(o===","&&!E){B(true)}if(s!=="TK_COMMENT"){if(E){q()}else{R()}}U();q();break;case"TK_UNKNOWN":U();break}u=o;s=b;o=i}var at=T+r.join("").replace(/[\r\n ]+$/,"");return at}if(typeof exports!=="undefined"){exports.js_beautify=js_beautify}